# –£–ª—É—á—à–µ–Ω–Ω–∞—è LightRAG Implementation (–ø–µ—Ä–µ–º–µ—â–µ–Ω–æ)

–ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ `docs/README_IMPROVED.md`.
## ü§ñ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ –∏ Fallback

–î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ö–∞–Ω–∏–∑–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏ (`dynamic_openai_complete`) –≤–º–µ—Å—Ç–æ –∂—ë—Å—Ç–∫–æ –ø—Ä–æ—à–∏—Ç–æ–π `gpt-4o-mini`.
1. –ë–µ—Ä—ë—Ç—Å—è –æ—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å –∏–∑ (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É):
  - `OPENAI_MODEL`
  - `RAG_LLM_MODEL`
3. –ï—Å–ª–∏ —Å—Ä–µ–¥–∏ fallback –Ω–µ—Ç `gpt-5-mini`, –æ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫–æ–Ω–µ—Ü —Ü–µ–ø–æ—á–∫–∏ (–∫–∞–∫ —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –±–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å).

4. –ï—Å–ª–∏ –≤—Å—ë –ø—Ä–æ–≤–∞–ª–∏–ª–æ—Å—å ‚Äî –ø–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `gpt_4o_mini_complete`.
OPENAI_FALLBACK_MODELS=gpt-5-mini,gpt-4.1-mini    # –ú–æ–∂–Ω–æ –ø–µ—Ä–µ—á–∏—Å–ª–∏—Ç—å —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é: gpt-5-mini,gpt-4o-mini
RAG_LLM_MODEL=gpt-5-mini             # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ (–µ—Å–ª–∏ OPENAI_MODEL –Ω–µ –∑–∞–¥–∞–Ω)
RAG_EMBEDDING_MODEL=gpt-5-mini       # Embedding –º–æ–¥–µ–ª—å ‚Äî –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
4. –î–µ—Ñ–æ–ª—Ç: `gpt-5-mini`

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–µ—Ñ–∏–∫—Å `openai:` –¥–ª—è pydantic-ai (`openai:gpt-5-mini`).
export OPENAI_FALLBACK_MODELS=gpt-5-mini,gpt-4.1-mini

4. –î–µ—Ñ–æ–ª—Ç: `gpt-5-mini`
3. –ï—Å–ª–∏ —Å—Ä–µ–¥–∏ fallback –Ω–µ—Ç `gpt-5-mini`, –æ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫–æ–Ω–µ—Ü —Ü–µ–ø–æ—á–∫–∏ (–∫–∞–∫ —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –±–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å).

4. –ï—Å–ª–∏ –≤—Å—ë –ø—Ä–æ–≤–∞–ª–∏–ª–æ—Å—å ‚Äî –ø–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `gpt_4o_mini_complete`.
  `dynamic_openai_complete: used fallback model 'gpt-5-mini' –≤–º–µ—Å—Ç–æ 'gpt-5'`

  "model_used": "gpt-5-mini",
  "model_tried": ["gpt-5", "gpt-5-mini"],

  "model_tried": ["gpt-5", "gpt-5-mini"]
OPENAI_FALLBACK_MODELS=gpt-5-mini,gpt-4.1-mini \

4. –î–µ—Ñ–æ–ª—Ç: `gpt-5-mini`
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–µ—Ñ–∏–∫—Å `openai:` –¥–ª—è pydantic-ai (`openai:gpt-5-mini`).

export OPENAI_FALLBACK_MODELS=gpt-5-mini,gpt-4.1-mini
4. –î–µ—Ñ–æ–ª—Ç: `gpt-5-mini`

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–µ—Ñ–∏–∫—Å `openai:` –¥–ª—è pydantic-ai (`openai:gpt-5-mini`).
OPENAI_FALLBACK_MODELS=gpt-5-mini,gpt-4.1-mini \

OPENAI_FALLBACK_MODELS=gpt-5-mini,gpt-4.1-mini
# –£–ª—É—á—à–µ–Ω–Ω–∞—è LightRAG Implementation (–ø–µ—Ä–µ–º–µ—â–µ–Ω–æ)

–ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ `docs/README_IMPROVED.md`.

–ü—Ä–∏—á–∏–Ω–∞ –ø–µ—Ä–µ–Ω–æ—Å–∞: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã ‚Äî –≤—Å–µ markdown —Ñ–∞–π–ª—ã —Ç–µ–ø–µ—Ä—å –≤ `docs/`.

–°–º. `docs/README_IMPROVED.md`.

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞**
- –í—ã–Ω–µ—Å–µ–Ω—ã –æ–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `common.py`
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è RAG
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —É—Ç–∏–ª–∏—Ç—ã

### 2. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
- –ü–∞—Ç—Ç–µ—Ä–Ω Manager –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è RAG
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ dataclass

### 3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
- Graceful error handling
- Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### 4. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ YAML —Ñ–∞–π–ª–æ–≤
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 5. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ú–µ—Ç—Ä–∏–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### 6. **–ì—Ä–∞—Ñ–æ–≤—ã–π —Å—Ç–µ–∫ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
–ü–æ–ª–Ω—ã–π `requirements.txt` –≤–∫–ª—é—á–∞–µ—Ç –∫–∞–∫ –±–∞–∑–æ–≤—ã–π RAG + API, —Ç–∞–∫ –∏ –≥—Ä–∞—Ñ/ML —Å—Ç–µ–∫ (networkx, graspologic, scikit-learn –∏ –¥—Ä.) ‚Äî –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Ä–µ–∂–∏–º–æ–≤ global/mix/hybrid.

### 7. **–ü–∞–º—è—Ç—å –¥–∏–∞–ª–æ–≥–æ–≤ –∏ –ª–∏–º–∏—Ç—ã (–Ω–æ–≤–æ–µ)**
- In-memory —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ `conversation_id` —Å –∞–≤—Ç–æ-–≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ system prompt.
- TTL –¥–∏–∞–ª–æ–≥–æ–≤ (–¥–µ—Ñ–æ–ª—Ç 1 —á–∞—Å) ‚Äî `RAG_CONVERSATION_TTL_SECONDS`.
- Rate limit per user: 10 –∑–∞–ø—Ä–æ—Å–æ–≤/—á–∞—Å (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç—Å—è `RAG_USER_RATE_LIMIT`, `RAG_USER_RATE_WINDOW_SECONDS`).
- –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è: `GET/DELETE /conversations`, `GET/DELETE /conversations/{id}`.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
LightRAG/
‚îú‚îÄ‚îÄ common.py              # –û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ RAGManager
‚îú‚îÄ‚îÄ config.py              # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
‚îú‚îÄ‚îÄ logger.py              # –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ rag_agent.py           # –û—Å–Ω–æ–≤–Ω–æ–π RAG –∞–≥–µ–Ω—Ç
‚îú‚îÄ‚îÄ insert_pydantic_docs.py # –í—Å—Ç–∞–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ test_rag.py            # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ examples.py            # –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ requirements.txt       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ README_IMPROVED.md     # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**
```bash

2. **–°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ**
# –∏–ª–∏
venv\Scripts\activate     # Windows
```bash
pip install -r requirements.txt
```bash
echo "OPENAI_API_KEY=your_api_key_here" > .env

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from common import RAGManager, RAGConfig
## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–º–æ–¥—É–ª—å–Ω–∞—è –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)

```
LightRAG/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py            # RAGConfig
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rag.py               # RAGManager + dynamic_openai_complete + —É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ agent/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rag_agent.py         # Pydantic AI –∞–≥–µ–Ω—Ç (retrieve tool)
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ server.py            # FastAPI (app.api.server:app)
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îú‚îÄ‚îÄ diagnostics.py       # Self-test –º–æ–¥–µ–ª–µ–π
‚îÇ       ‚îî‚îÄ‚îÄ logging.py           # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ PerformanceLogger
‚îú‚îÄ‚îÄ common.py                    # Shim ‚Üí app.core (DeprecationWarning)
‚îú‚îÄ‚îÄ rag_agent.py                 # Shim ‚Üí app.agent.rag_agent
‚îú‚îÄ‚îÄ api_server.py                # Shim ‚Üí app.api.server
‚îú‚îÄ‚îÄ diagnostics.py               # Shim ‚Üí app.utils.diagnostics
‚îú‚îÄ‚îÄ logger.py                    # Shim ‚Üí app.utils.logging
‚îú‚îÄ‚îÄ monkey_patch_lightrag.py     # Monkey patch LightRAG.get_vector_context
‚îú‚îÄ‚îÄ insert_pydantic_docs.py      # –í—Å—Ç–∞–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ examples.py                  # –ü—Ä–∏–º–µ—Ä—ã
‚îú‚îÄ‚îÄ test_rag.py                  # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ requirements.txt             # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ README_IMPROVED.md           # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

Shim-—Ñ–∞–π–ª—ã –æ—Å—Ç–∞–≤–ª–µ–Ω—ã –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –∏ –±—É–¥—É—Ç –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–¥–∞–ª—è—Ç—å—Å—è. –ù–æ–≤—ã–µ –∏–º–ø–æ—Ä—Ç—ã –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–∑ `app.*`.
    # –í—Å—Ç–∞–≤—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
    await rag.ainsert("–í–∞—à —Ç–µ–∫—Å—Ç –∑–¥–µ—Å—å")
    
    # –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å
    response = await rag.aquery("–í–∞—à –≤–æ–ø—Ä–æ—Å")
    print(response)

asyncio.run(main())
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞

```python
from rag_agent import run_rag_agent
import asyncio

async def main():
    response = await run_rag_agent("–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ?")
    print(response)

asyncio.run(main())
```

### –í—Å—Ç–∞–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

```bash
# –í—Å—Ç–∞–≤–∏—Ç—å –æ–¥–∏–Ω —Ñ–∞–π–ª
python insert_pydantic_docs.py --file /path/to/document.txt

# –í—Å—Ç–∞–≤–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏
python insert_pydantic_docs.py --directory /path/to/documents/

from app.core import RAGManager, RAGConfig
python insert_pydantic_docs.py --url
```

<!-- Streamlit UI –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–∫–ª—é—á—ë–Ω: —Ñ–∞–π–ª streamlit_app.py —É–¥–∞–ª—ë–Ω -->

### –ó–∞–ø—É—Å–∫ FastAPI —Å–µ—Ä–≤–µ—Ä–∞

```bash
cd LightRAG
bash start_api.sh
```

–°–∫—Ä–∏–ø—Ç –¥–µ–ª–∞–µ—Ç:
- –°–æ–∑–¥–∞–Ω–∏–µ / –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ venv
- –ê–≤—Ç–æ-upgrade pip (—Ç–∏—Ö–∏–π —Ä–µ–∂–∏–º)
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏–∑ `requirements.txt`
- –î–æ—É—Å—Ç–∞–Ω–æ–≤–∫—É `fastapi` –∏ `uvicorn`, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
- –ü—Ä–æ–≤–µ—Ä–∫—É `.env` (ÊèêÁ§∫ –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)
- –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (`pydantic-docs`)

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:
```
http://localhost:8000/health  # health check
http://localhost:8000/docs    # Swagger UI
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API (—ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ CLI –≤–æ–ø—Ä–æ—Å—É)
from app.agent.rag_agent import run_rag_agent
# Health
curl -s http://localhost:8000/health | python -m json.tool

# –ü—Ä–æ—Å—Ç–æ–π –≤–æ–ø—Ä–æ—Å —á–µ—Ä–µ–∑ —á–∞—Ç-—ç–Ω–¥–ø–æ–∏–Ω—Ç
curl -s -X POST http://localhost:8000/chat \
  -H 'Content-Type: application/json' \
  -d '{"message":"How do I create a Pydantic AI agent?"}' | python -m json.tool
```

### –û –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö
–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É –¥–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è ‚Äî —Å–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π trimmed —Ñ–∞–π–ª –≤—Ä—É—á–Ω—É—é, –Ω–æ –≥—Ä–∞—Ñ–æ–≤—ã–µ —Ä–µ–∂–∏–º—ã –º–æ–≥—É—Ç –¥–µ–≥—Ä–∞–¥–∏—Ä–æ–≤–∞—Ç—å.

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ß–µ—Ä–µ–∑ YAML —Ñ–∞–π–ª

–°–æ–∑–¥–∞–π—Ç–µ `config.yaml`:

```yaml
openai:
  api_key: "your_api_key"
  model: "gpt-4.1-mini"
  temperature: 0.0

rag:
  working_dir: "./documents"
  rerank_enabled: true
  batch_size: 20
bash start_api.sh  # –∑–∞–ø—É—Å–∫–∞–µ—Ç shim api_server:app ‚Üí app.api.server:app

app:
  debug: false
  log_level: "INFO"
  enable_streaming: true
```

### –ß–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
export OPENAI_API_KEY="your_key"
export RAG_WORKING_DIR="./docs"
from app.utils.logging import performance_logger
export APP_DEBUG="false"
```

## ü§ñ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ –∏ Fallback

–î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ö–∞–Ω–∏–∑–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏ (`dynamic_openai_complete`) –≤–º–µ—Å—Ç–æ –∂—ë—Å—Ç–∫–æ –ø—Ä–æ—à–∏—Ç–æ–π `gpt-4o-mini`.

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –ë–µ—Ä—ë—Ç—Å—è –æ—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å –∏–∑ (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É):
   - `OPENAI_MODEL`
   - `RAG_LLM_MODEL`
   - –¥–µ—Ñ–æ–ª—Ç: `gpt-4.1-mini`
2. –ï—Å–ª–∏ –º–æ–¥–µ–ª—å = `gpt-5` (–∏–ª–∏ –ª—é–±–∞—è –¥—Ä—É–≥–∞—è) –∏ –≤—ã–∑–æ–≤ –Ω–µ —É–¥–∞–ª—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `model_not_found`), —Å–∏—Å—Ç–µ–º–∞ –ø–æ –æ—á–µ—Ä–µ–¥–∏ –ø—Ä–æ–±—É–µ—Ç –º–æ–¥–µ–ª–∏ –∏–∑ —Å–ø–∏—Å–∫–∞ `OPENAI_FALLBACK_MODELS`.
3. –ï—Å–ª–∏ —Å—Ä–µ–¥–∏ fallback –Ω–µ—Ç `gpt-4.1-mini`, –æ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫–æ–Ω–µ—Ü —Ü–µ–ø–æ—á–∫–∏.
4. –ï—Å–ª–∏ –≤—Å—ë –ø—Ä–æ–≤–∞–ª–∏–ª–æ—Å—å ‚Äî –ø–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `gpt_4o_mini_complete`.

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
OPENAI_MODEL=gpt-5                     # –ü—ã—Ç–∞–µ–º—Å—è —Å–Ω–∞—á–∞–ª–∞ –µ—ë
OPENAI_FALLBACK_MODELS=gpt-4.1-mini    # –ú–æ–∂–Ω–æ –ø–µ—Ä–µ—á–∏—Å–ª–∏—Ç—å —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é: gpt-4.1-mini,gpt-4o-mini
RAG_LLM_MODEL=gpt-4.1-mini             # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ (–µ—Å–ª–∏ OPENAI_MODEL –Ω–µ –∑–∞–¥–∞–Ω)
RAG_EMBEDDING_MODEL=gpt-4.1-mini       # Embedding –º–æ–¥–µ–ª—å ‚Äî –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

–ü—Ä–∏–º–µ—Ä .env –¥–ª—è –ø–æ–ø—ã—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–æ–π `gpt-5` —Å –æ—Ç–∫–∞—Ç–æ–º:

```bash
OPENAI_MODEL=gpt-5
OPENAI_FALLBACK_MODELS=gpt-4.1-mini,gpt-4o-mini
```

–õ–æ–≥–∏:
- –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ fallback —É–≤–∏–¥–∏—Ç–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤–∏–¥–∞:
  `dynamic_openai_complete: used fallback model 'gpt-4.1-mini' instead of 'gpt-5'`
- –û—à–∏–±–∫–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å `dynamic_openai_complete: model '...' failed:`

–í–∞–∂–Ω–æ:
- –ù–∞–ª–∏—á–∏–µ —Å—Ç—Ä–æ–∫–∏ `gpt-5` –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø ‚Äî –µ—Å–ª–∏ —É –∞–∫–∫–∞—É–Ω—Ç–∞ –Ω–µ—Ç —Ç–∞–∫–æ–π –º–æ–¥–µ–ª–∏, —Å—Ä–∞–∑—É –±—É–¥–µ—Ç fallback.
- Embedding —Ñ—É–Ω–∫—Ü–∏—è –æ—Å—Ç–∞—ë—Ç—Å—è –ø—Ä–µ–∂–Ω–µ–π (`openai_embed`) ‚Äî –∑–∞–¥–∞–≤–∞–π—Ç–µ –µ–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –º–æ–¥–µ–ª—å —á–µ—Ä–µ–∑ `RAG_EMBEDDING_MODEL` –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
- –ú–æ–∂–Ω–æ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ –º–µ–Ω—è—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±–µ–∑ –ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞, —Ä–µ–¥–∞–∫—Ç–∏—Ä—É—è —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ.

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã–µ fallback –º–æ–¥–µ–ª–∏, —á—Ç–æ–±—ã –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è –Ω–∞ –ª–∏—à–Ω–∏–µ –æ—à–∏–±–∫–∏.
- –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ —Ä–∞–∑–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–ª—è fallback ‚Äî –ø–æ–∫–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ø–æ-–æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—â–∞—è `OPENAI_TEMPERATURE`).
- –°–ª–µ–¥–∏—Ç–µ –∑–∞ —Å—Ç–æ–∏–º–æ—Å—Ç—å—é: –±–æ–ª–µ–µ –Ω–æ–≤—ã–µ/–±–æ–ª—å—à–∏–µ –º–æ–¥–µ–ª–∏ –º–æ–≥—É—Ç —Å—Ç–æ–∏—Ç—å –¥–æ—Ä–æ–∂–µ.

–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
```python
from openai import OpenAI
client = OpenAI()
print([m.id for m in client.models.list() if 'gpt' in m.id])
```

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–∫–ª—é—á–∏—Ç—å fallback –∏ –∂—ë—Å—Ç–∫–æ —Ñ–µ–π–ª–∏—Ç—å—Å—è ‚Äî –ø—Ä–æ—Å—Ç–æ –Ω–µ –∑–∞–¥–∞–≤–∞–π—Ç–µ `OPENAI_FALLBACK_MODELS` –∏ –ø–æ—Å—Ç–∞–≤—å—Ç–µ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –º–æ–¥–µ–ª—å: –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç —Ç–æ–ª—å–∫–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π fallback.

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π Health endpoint —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –º–æ–¥–µ–ª–∏

–≠–Ω–¥–ø–æ–∏–Ω—Ç `/health` —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å self-test –º–æ–¥–µ–ª–∏.
  "status": "healthy",
  "rag_status": "healthy",
  "version": "1.0.0",
  "model_ok": true,
  "model_used": "gpt-4.1-mini",
  "model_tried": ["gpt-5", "gpt-4.1-mini"],
  "temperature_auto_adjusted": true,
  "temperature_current": "0.1",
```

–ü—Ä–∏–º–µ—Ä –Ω–µ—É—Å–ø–µ—à–Ω–æ–≥–æ (fallback —Ç–æ–∂–µ –Ω–µ –ø–æ–º–æ–≥):
```jsonc
{
  "status": "healthy",
  "rag_status": "healthy",
  "version": "1.0.0",
  "model_ok": false,
  "model_error": "model_not_found: gpt-5",
  "model_tried": ["gpt-5", "gpt-4.1-mini"]
}
```

–ü–æ–ª—è:
- `model_ok` ‚Äì bool –∏–ª–∏ null (–µ—Å–ª–∏ self-test –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª—Å—è)
- `model_used` ‚Äì —Ä–µ–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–≤–µ—Ç–∏–ª–∞ –ø–µ—Ä–≤–æ–π —É—Å–ø–µ—à–Ω–æ
- `model_tried` ‚Äì —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –ø–æ –ø–æ—Ä—è–¥–∫—É –ø–æ–ø—ã—Ç–æ–∫
- `model_error` ‚Äì —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏, –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å
 - `temperature_auto_adjusted` ‚Äì –ø—Ä–∏–º–µ–Ω—è–ª–∞—Å—å –ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è (–µ—Å–ª–∏ –º–æ–¥–µ–ª–∏ –Ω–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç temperature=0)
 - `temperature_current` ‚Äì –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π OPENAI_TEMPERATURE –ø–æ—Å–ª–µ –≤–æ–∑–º–æ–∂–Ω–æ–π –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏
 - `temperature_rejected_models` ‚Äì —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π, –æ—Ç–∫–ª–æ–Ω–∏–≤—à–∏—Ö temperature=0, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö —Ç–µ–ø–µ—Ä—å –Ω–µ —É–∫–∞–∑—ã–≤–∞–µ–º —è–≤–Ω—É—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É

Self-test –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞. –î–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å / –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä. –õ—ë–≥–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –≤–æ–∑–º–æ–∂–Ω–∞, –Ω–æ –∑–∞–ø—Ä–æ—Å –∫–æ—Ä–æ—Ç–∫–∏–π (`ping`).

```python
from logger import performance_logger
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–∞–π–º–µ—Ä
performance_logger.start_timer("document_processing")

# –í–∞—à –∫–æ–¥ –∑–¥–µ—Å—å
process_documents()

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–∞–π–º–µ—Ä
performance_logger.end_timer("document_processing")

# –õ–æ–≥–∏—Ä—É–π—Ç–µ –º–µ—Ç—Ä–∏–∫–∏
performance_logger.log_metric("documents_processed", 100, "docs")

# –ü–æ–ª—É—á–∏—Ç–µ —Å–≤–æ–¥–∫—É
## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ —Ç–µ—Å—Ç—ã
python -m pytest test_rag.py -v

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
python -m pytest test_rag.py::TestRAGConfig::test_default_config -v
```

## üìù –ü—Ä–∏–º–µ—Ä—ã

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ –ø—Ä–∏–º–µ—Ä—ã:

```bash
python examples.py
```

–ò–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã:

```python
from examples import example_basic_usage, example_agent_usage

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã
asyncio.run(example_basic_usage())
asyncio.run(example_agent_usage())
```

## üîß CLI –∫–æ–º–∞–Ω–¥—ã

### RAG Agent

```bash
# –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
python rag_agent.py --question "–í–∞—à –≤–æ–ø—Ä–æ—Å"

# –° –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
python rag_agent.py \
  --question "–í–∞—à –≤–æ–ø—Ä–æ—Å" \
  --working-dir "./custom-docs" \
  --no-rerank

# –Ø–≤–Ω—ã–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ (–ø–µ—Ä–µ–±–∏–≤–∞–µ—Ç OPENAI_MODEL / RAG_LLM_MODEL)
python rag_agent.py --question "Test" --model gpt-5

# –û—Ç–∫–ª—é—á–∏—Ç—å fallback —Ü–µ–ø–æ—á–∫—É (–≤–µ—Ä–Ω—ë—Ç –æ—à–∏–±–∫—É –µ—Å–ª–∏ –º–æ–¥–µ–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞)
python rag_agent.py --question "Test" --model gpt-5 --no-fallback

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π prompt –∏–∑ —Ñ–∞–π–ª–∞ –∏ fallback —Å–ø–∏—Å–æ–∫ –∏–∑ –æ–∫—Ä—É–∂–µ–Ω–∏—è
OPENAI_FALLBACK_MODELS=gpt-4.1-mini,gpt-4o-mini \
python rag_agent.py --question "Explain indexing" --system-prompt-file custom_prompt.txt --model gpt-5
```

#### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ –≤ –∞–≥–µ–Ω—Ç–µ

–ê–≥–µ–Ω—Ç —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—É –∂–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏, —á—Ç–æ –∏ –æ—Å—Ç–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞:

–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –º–æ–¥–µ–ª–∏:
1. `--model` (CLI –∞—Ä–≥—É–º–µ–Ω—Ç)
2. `OPENAI_MODEL`
3. `RAG_LLM_MODEL`
4. –î–µ—Ñ–æ–ª—Ç: `gpt-4.1-mini`

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–µ—Ñ–∏–∫—Å `openai:` –¥–ª—è pydantic-ai (`openai:gpt-4.1-mini`).

Fallback –ª–æ–≥–∏–∫–∞ –≤ –∞–≥–µ–Ω—Ç–µ —É–ø—Ä–æ—â—ë–Ω–Ω–∞—è (—É–º—ã—à–ª–µ–Ω–Ω–æ –¥–ª—è –Ω–∏–∑–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏):
- –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—à–∏–±–∫–µ —Å –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏ `model_not_found` –∏–ª–∏ `404`.
- –ë–µ—Ä—ë—Ç –ø–µ—Ä–≤—É—é –º–æ–¥–µ–ª—å –∏–∑ `OPENAI_FALLBACK_MODELS` (–µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞–Ω).
- –í—ã–ø–æ–ª–Ω—è–µ—Ç –û–î–ù–£ –ø–æ–≤—Ç–æ—Ä–Ω—É—é –ø–æ–ø—ã—Ç–∫—É. (–ì–ª—É–±–æ–∫–∏–π –∫–∞—Å–∫–∞–¥ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ `dynamic_openai_complete` –¥–ª—è RAG –≤–Ω—É—Ç—Ä–∏ LightRAG.)
- –ï—Å–ª–∏ –ø–æ–≤—Ç–æ—Ä —Ç–æ–∂–µ —É–ø–∞–ª ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ –≤–º–µ—Å—Ç–æ –æ—Ç–≤–µ—Ç–∞.

–ü—Ä–∏–º–µ—Ä—ã:
```bash
# –û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å gpt-5, fallback —Å–ø–∏—Å–æ–∫
export OPENAI_MODEL=gpt-5
export OPENAI_FALLBACK_MODELS=gpt-4.1-mini,gpt-4o-mini
python rag_agent.py --question "How to configure embeddings?"

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å fallback
python rag_agent.py --question "How to configure embeddings?" --no-fallback
```

–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–≤: —Ñ–∞–±—Ä–∏–∫–∞ `create_agent()` –∫—ç—à–∏—Ä—É–µ—Ç –∏–Ω—Å—Ç–∞–Ω—Å—ã (LRU –¥–æ 32 –∫–æ–º–±–∏–Ω–∞—Ü–∏–π model+prompt) ‚Äî –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤—ã–∑–æ–≤—ã —Å —Ç–µ–º–∏ –∂–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ –Ω–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—é—Ç –æ–±—ä–µ–∫—Ç.

–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤: `retrieve` –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞–≥–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ `_register_tools`, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–≥–µ–Ω—Ç–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ prompt –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤.

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- –î–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ `python rag_agent.py --question ping --model gpt-X`.
- –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –º–Ω–æ–≥–æ—Å—Ç—É–ø–µ–Ω—á–∞—Ç–∞—è —Ü–µ–ø–æ—á–∫–∞ fallback –≤–Ω—É—Ç—Ä–∏ —Å–∞–º–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ ‚Äî —Ä–∞—Å—à–∏—Ä—å—Ç–µ –±–ª–æ–∫ –≤ `run_rag_agent` (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –º–µ—Å—Ç—É —É–∂–µ –æ—á–µ–≤–∏–¥–µ–Ω –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ).
- –î–ª—è —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/health` (self-test Responses API) –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç.

### –í—Å—Ç–∞–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

```bash
# –ü–æ–º–æ—â—å
python insert_pydantic_docs.py --help

# –í—Å—Ç–∞–≤–∫–∞ —Ñ–∞–π–ª–∞
python insert_pydantic_docs.py --file document.txt

# –í—Å—Ç–∞–≤–∫–∞ –ø–∞–ø–∫–∏
python insert_pydantic_docs.py --directory ./docs/
```

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å gracefully –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏:

- –ù–µ–≤–µ—Ä–Ω—ã–µ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º
- –ü—Ä–æ–±–ª–µ–º—ã —Å API
- –û—à–∏–±–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- –ü—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

## üìà –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:

```python
from logger import setup_logger

# –ë–∞–∑–æ–≤–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
logger = setup_logger("myapp", "INFO")

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–∞–π–ª
logger = setup_logger("myapp", "DEBUG", "app.log")

# –ö–∞—Å—Ç–æ–º–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
logger = setup_logger("myapp", "INFO", log_format="%(levelname)s: %(message)s")
```

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏

1. **–û–±–Ω–æ–≤–∏—Ç–µ –∏–º–ø–æ—Ä—Ç—ã**:
   ```python
   # –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±
   from lightrag import LightRAG
   
   # –ù–æ–≤—ã–π —Å–ø–æ—Å–æ–±
   from common import RAGManager, RAGConfig
   ```

2. **–ó–∞–º–µ–Ω–∏—Ç–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é**:
   ```python
   # –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±
   rag = LightRAG(working_dir="./docs")
   await rag.initialize_storages()
   
   # –ù–æ–≤—ã–π —Å–ø–æ—Å–æ–±
   config = RAGConfig(working_dir="./docs")
   rag_manager = RAGManager(config)
   rag = await rag_manager.initialize()
   ```

3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–æ–≤—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫**:
   ```python
   try:
       response = await rag.aquery(query)
   except Exception as e:
       logger.error(f"Query failed: {e}")
       # Graceful fallback
   ```

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

1. Fork —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. –°–æ–∑–¥–∞–π—Ç–µ feature branch
3. –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã
5. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- –°–æ–∑–¥–∞–π—Ç–µ Issue –¥–ª—è –±–∞–≥–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Discussions –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ examples.py –¥–ª—è –ø—Ä–∏–º–µ—Ä–æ–≤
- –ò–∑—É—á–∏—Ç–µ test_rag.py –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è API 

## üîç –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —Ç–∏–ø–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

### 1. –°–æ–æ–±—â–µ–Ω–∏–µ pip: `[notice] A new release of pip is available`
–ú–æ–∂–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å (–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ). –í —Å–∫—Ä–∏–ø—Ç–µ `start_api.sh` —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è `pip install --upgrade --quiet pip`.

### 2. `ModuleNotFoundError: No module named 'fastapi'`
–ü—Ä–∏—á–∏–Ω—ã:
- –ó–∞–ø—É—Å–∫ –¥–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ü–µ—Ä–µ–ø—É—Ç–∞–Ω venv
–†–µ—à–µ–Ω–∏–µ: –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–ª–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å `pip install -r requirements.txt` –∏–ª–∏ –≤—Ä—É—á–Ω—É—é `pip install fastapi uvicorn`.

### 3. –ö–æ–Ω—Ñ–ª–∏–∫—Ç `starlette` –∏ `sse-starlette`
–°–æ–æ–±—â–µ–Ω–∏–µ –≤–∏–¥–∞: `requires starlette>=0.41.3 but you have starlette 0.36.x`.
–†–µ—à–µ–Ω–∏–µ –¥–ª—è –ª—ë–≥–∫–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è: —É–±—Ä–∞—Ç—å `sse-starlette` / `httpx-sse`, –æ–Ω–∏ –Ω–µ –Ω—É–∂–Ω—ã –¥–ª—è –±–∞–∑–æ–≤–æ–≥–æ API.

### 4. Health endpoint –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–≤–µ—Ä—à–∏–ª—Å—è –ª–∏ startup (–¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è `Application startup complete`). –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è LightRAG –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ.

### 5. –ù–µ—Ç –æ—Ç–≤–µ—Ç–æ–≤ / –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤—Å—Ç–∞–≤–ª–µ–Ω—ã (`pydantic-docs` —Å–æ–¥–µ—Ä–∂–∏—Ç JSON-—Ö—Ä–∞–Ω–∏–ª–∏—â–∞) –∏–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ `insert_pydantic_docs.py`.

### 6. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤ —á–∏—Å—Ç–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏
```bash
rm -rf LightRAG/venv
bash LightRAG/start_api.sh
```

### 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
which python
python -c "import fastapi, lightrag; print('OK')"
```

## üóú –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –î–ª—è CI –º–æ–∂–Ω–æ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–π —Å–æ–∫—Ä–∞—â—ë–Ω–Ω—ã–π requirements, –Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª–Ω—ã–π.
- –ò–∑–±–µ–≥–∞–π—Ç–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –≤—Å—Ç–∞–≤–∫–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –ö–µ—à–∏—Ä—É–π—Ç–µ –æ—Ç–≤–µ—Ç—ã (—Å–º. `kv_store_llm_response_cache.json`)
- –°–ª–µ–¥–∏—Ç–µ –∑–∞ —Ä–∞–∑–º–µ—Ä–æ–º —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: —É–¥–∞–ª—è–π—Ç–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ñ–∞–π–ª—ã –ø–µ—Ä–µ–¥ –º–∞—Å—Å–æ–≤–æ–π –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–µ–π

## üß© –ü–ª–∞–Ω –≤–æ–∑–º–æ–∂–Ω—ã—Ö –¥–∞–ª—å–Ω–µ–π—à–∏—Ö —É–ª—É—á—à–µ–Ω–∏–π
- –ò–º–ø–æ—Ä—Ç Postman –∫–æ–ª–ª–µ–∫—Ü–∏–∏: `LightRAG.postman_collection.json`

## üß™ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —á–µ—Ä–µ–∑ Postman / Bruno / Hoppscotch

1. –û—Ç–∫—Ä–æ–π—Ç–µ Postman ‚Üí Import ‚Üí –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª `LightRAG/LightRAG.postman_collection.json`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω (`bash start_api.sh`)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø—Ä–æ—Å—ã:
  - Health Check
  - Chat: Ask Question
  - Documents: Insert / Search
  - Config: Get / Update
4. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `base_url` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `http://localhost:8000`)

–î–ª—è Bruno/Hoppscotch –º–æ–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å raw JSON –∫–æ–ª–ª–µ–∫—Ü–∏–∏.
- –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π health-–ø–æ–ª–ª–∏–Ω–≥ –≤ —Å–∫—Ä–∏–ø—Ç
- –í—ã–Ω–µ—Å—Ç–∏ curl-–ø—Ä–∏–º–µ—Ä—ã –≤ Postman –∫–æ–ª–ª–µ–∫—Ü–∏—é
- –î–æ–±–∞–≤–∏—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç `/ask` —Å –≤—ã–±–æ—Ä–æ–º —Ä–µ–∂–∏–º–∞ (mix/hybrid/local)
- –í–∫–ª—é—á–∏—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ SSE –¥–ª—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ (—Ç—Ä–µ–±—É–µ—Ç –≤–µ—Ä–Ω—É—Ç—å `sse-starlette` –≤ –ø–æ–ª–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å)