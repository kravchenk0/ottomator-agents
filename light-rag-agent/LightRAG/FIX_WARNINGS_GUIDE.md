# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## –ü—Ä–æ–±–ª–µ–º—ã –≤ –≤–∞—à–∏—Ö –ª–æ–≥–∞—Ö

### 1. ‚ùå –ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–µ–ª–∏ OpenAI
```
WARNING: model 'gpt-5-mini' failed: Request timed out.
WARNING: model 'gpt-4.1-mini' failed: Request timed out.
```

**–ü—Ä–∏—á–∏–Ω–∞**: –í –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–µ–ª–∏ OpenAI.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: ‚úÖ –ú–æ–¥–µ–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ:
- `gpt-5-mini` ‚Üí `gpt-4o-mini`
- `gpt-4.1-mini` ‚Üí `gpt-4o-mini` 
- `gpt-5-mini` (embedding) ‚Üí `text-embedding-3-small`

### 2. ‚ùå –î–æ–ª–≥–∏–µ —Ç–∞–π–º–∞—É—Ç—ã –∏ retry
```
INFO:openai._base_client:Retrying request to /chat/completions in 0.881771 seconds
```

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ timeout –∏ retry.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã:
- OpenAI timeout: 60s ‚Üí 45s
- Max retries: 3 ‚Üí 2 (–º–µ–Ω—å—à–µ warning'–æ–≤)
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è RAG: 10s/20s/45s

### 3. ‚ùå –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∏–Ω–≥–µ—Å—Ç–∏—è (326 —Å–µ–∫—É–Ω–¥)
```
"processing_time_seconds": 326.7, "files_per_second": 0.0
```

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ batch –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –¥–ª–∏–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã.

## ‚úÖ –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –í –∫–æ–¥–µ:
1. **app/core/rag.py**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –º–æ–¥–µ–ª–∏ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
2. **app/agent/rag_agent.py**: –û–±–Ω–æ–≤–ª–µ–Ω fallback –Ω–∞ gpt-4o-mini
3. **.env**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏

### –ù–æ–≤—ã–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```bash
# –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏
OPENAI_MODEL=gpt-4o-mini
RAG_LLM_MODEL=gpt-4o-mini  
RAG_EMBEDDING_MODEL=text-embedding-3-small

# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã
OPENAI_TIMEOUT_SECONDS=45
RAG_RETRIEVE_TIMEOUT_FAST=10
RAG_RETRIEVE_TIMEOUT_MEDIUM=20
RAG_RETRIEVE_TIMEOUT_SECONDS=45

# –£—Å–∫–æ—Ä–µ–Ω–Ω–∞—è –∏–Ω–≥–µ—Å—Ç–∏—è
RAG_INGEST_BATCH_SIZE=10
RAG_INGEST_CONCURRENT_INSERTS=3
```

## üöÄ –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
```bash
# –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
docker exec -it lightrag-api bash

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
export OPENAI_MODEL=gpt-4o-mini
export RAG_LLM_MODEL=gpt-4o-mini
export OPENAI_TIMEOUT_SECONDS=45
export RAG_INGEST_BATCH_SIZE=10

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∏–Ω–≥–µ—Å—Ç–∏—é:
python tools/ingest_local.py --directory /app/documents/raw_uploads
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –û–±–Ω–æ–≤–∏—Ç—å .env –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π .env —Ñ–∞–π–ª –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker cp .env lightrag-api:/app/.env

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker restart lightrag-api

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–Ω–≥–µ—Å—Ç–∏—é
docker exec -it lightrag-api python tools/ingest_local.py --directory /app/documents/raw_uploads
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
docker cp fix_models_and_performance.sh lightrag-api:/app/

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –µ–≥–æ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker exec -it lightrag-api bash /app/fix_models_and_performance.sh
```

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚ùå –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ "model does not exist"
- ‚ùå –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ retry –∏ timeout
- ‚ùå –ò–Ω–≥–µ—Å—Ç–∏—è: 326 —Å–µ–∫—É–Ω–¥ –¥–ª—è 1 —Ñ–∞–π–ª–∞
- ‚ùå –ú–Ω–æ–≥–æ WARNING —Å–æ–æ–±—â–µ–Ω–∏–π

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚úÖ –í—Å–µ –º–æ–¥–µ–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ò–Ω–≥–µ—Å—Ç–∏—è: ~60-120 —Å–µ–∫—É–Ω–¥ (3-5x –±—ã—Å—Ç—Ä–µ–µ)
- ‚úÖ –ú–∏–Ω–∏–º—É–º warning'–æ–≤
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –±–µ–∑ fallback'–æ–≤

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –µ—â–µ –±–æ–ª—å—à–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å:

### –î–ª—è –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ–π –∏–Ω–≥–µ—Å—Ç–∏–∏:
```bash
export RAG_RERANK_ENABLED=false
export RAG_CHUNK_SIZE=500
export RAG_INGEST_BATCH_SIZE=5
export OPENAI_TIMEOUT_SECONDS=30
```

### –î–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ —Å–ª–∞–±–æ–º –∂–µ–ª–µ–∑–µ:
```bash
export RAG_INGEST_CONCURRENT_INSERTS=1
export RAG_INGEST_MAX_WORKERS=2
export RAG_INGEST_BATCH_SIZE=5
```

## üéØ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:

1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ –º–æ–¥–µ–ª–µ–π**:
```
INFO: OpenAI request: model=gpt-4o-mini, timeout=45s
```

2. **–ë—ã—Å—Ç—Ä–∞—è –∏–Ω–≥–µ—Å—Ç–∏—è**:
```
"processing_time_seconds": 90.5, "files_per_second": 0.01
```

3. **–ú–∏–Ω–∏–º—É–º retry —Å–æ–æ–±—â–µ–Ω–∏–π** –æ—Ç OpenAI

4. **–°—Ç–∞–±–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É** –±–µ–∑ fallback –Ω–∞ builtin —Ñ—É–Ω–∫—Ü–∏–∏

---

**–†–µ–∑—é–º–µ**: –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥–µ–ª–µ–π OpenAI. –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ warning'–∏ –¥–æ–ª–∂–Ω—ã –∏—Å—á–µ–∑–Ω—É—Ç—å, –∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∏—Ç—Å—è!