# SSH Host Key Fix Utility

Скрипты для безопасного удаления устаревшего host key и добавления нового ключа для конкретного IP.

## Проблема
Сообщение:
```
WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!
Offending ECDSA key in ... known_hosts:LINE
```
Означает, что ключ хоста (например, после пересоздания EC2) изменился. Нужно удалить старую запись и добавить новую.

## Шаги вручную (коротко)
1. Посмотреть какую строку удалить: `ssh-keygen -F 15.184.123.110`
2. Удалить запись: `ssh-keygen -R 15.184.123.110`
3. Получить новый ключ: `ssh-keyscan -H 15.184.123.110 >> ~/.ssh/known_hosts`
4. Проверить: `ssh -i ~/.ssh/id_rsa ec2-user@15.184.123.110`

## Автоматизированный скрипт
Используй `fix_hostkey.sh` для автоматизации. По умолчанию IP берётся из аргумента.

```bash
./fix_hostkey.sh 15.184.123.110
```

Скрипт:
- Создаёт резервную копию `~/.ssh/known_hosts` с таймстампом.
- Удаляет старый ключ (если есть).
- Захватывает новый ED25519 / RSA ключи через `ssh-keyscan`.
- Показывает дифф.

## Безопасность
Перед добавлением нового ключа можно вручную сверить fingerprint через AWS Console (EC2 -> Instance -> Get console output при первом запуске для некоторых AMI) или через доверенный канал. Скрипт не выполняет криптографической верификации.

## Rollback
Восстановить из backup:
```bash
cp ~/.ssh/known_hosts.backup-<timestamp> ~/.ssh/known_hosts
```
